<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLC Debugger | Romio Network</title>
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --bg-0: #09090b;
            --bg-1: #0c0c0f;
            --bg-2: #131316;
            --bg-3: #18181b;
            --bg-4: #1f1f23;
            --bg-hover: #27272a;
            --border: #27272a;
            --border-subtle: #1f1f23;
            --text: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --success: #22c55e;
            --warning: #eab308;
            --error: #ef4444;
            --purple: #a855f7;
            --cyan: #06b6d4;
            --mono: 'SF Mono', 'Monaco', 'Consolas', 'Liberation Mono', monospace;
            --sans: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            --radius: 8px;
            --radius-sm: 6px;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: var(--sans);
            background: var(--bg-0);
            color: var(--text);
            font-size: 14px;
            line-height: 1.5;
        }

        /* Layout */
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            height: 48px;
            background: var(--bg-1);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 15px;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: white;
        }

        .header-center {
            display: flex;
            gap: 2px;
        }

        .tab {
            padding: 6px 14px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.15s;
        }

        .tab:hover {
            color: var(--text);
            background: var(--bg-hover);
        }

        .tab.active {
            color: var(--text);
            background: var(--bg-3);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 500;
            border-radius: 9999px;
            background: var(--bg-3);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-muted);
        }

        .status-badge.online .status-dot { background: var(--success); }
        .status-badge.connecting .status-dot { background: var(--warning); animation: pulse 1s infinite; }
        .status-badge.error .status-dot { background: var(--error); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main content */
        .main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-1);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-section {
            padding: 12px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .network-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .stat-card {
            background: var(--bg-2);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            padding: 10px;
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .stat-value {
            font-family: var(--mono);
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin-top: 2px;
        }

        .stat-value.accent { color: var(--accent); }
        .stat-value.success { color: var(--success); }
        .stat-value.warning { color: var(--warning); }

        /* Prelude buttons */
        .prelude-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
        }

        .prelude-btn {
            padding: 8px;
            font-family: var(--mono);
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--bg-2);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.15s;
        }

        .prelude-btn:hover {
            color: var(--text);
            background: var(--bg-3);
            border-color: var(--border);
        }

        /* Settings */
        .settings-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .setting-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-label {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 60px;
        }

        .setting-input {
            flex: 1;
            padding: 6px 10px;
            font-family: var(--mono);
            font-size: 12px;
            color: var(--text);
            background: var(--bg-2);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            outline: none;
            transition: border-color 0.15s;
        }

        .setting-input:focus {
            border-color: var(--accent);
        }

        .setting-input.small {
            width: 80px;
            flex: none;
        }

        select.setting-input {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2371717a' d='M3 4.5L6 7.5L9 4.5'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 8px center;
            padding-right: 24px;
        }

        select.setting-input option {
            background: var(--bg-2);
            color: var(--text);
        }

        /* Content area */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Editor */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background: var(--bg-2);
            border-bottom: 1px solid var(--border-subtle);
        }

        .editor-tabs {
            display: flex;
            gap: 4px;
        }

        .editor-tab {
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.15s;
        }

        .editor-tab:hover {
            color: var(--text-secondary);
        }

        .editor-tab.active {
            color: var(--text);
            background: var(--bg-3);
        }

        .editor-actions {
            display: flex;
            gap: 6px;
        }

        .editor-wrap {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .editor {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            padding: 16px;
            font-family: var(--mono);
            font-size: 14px;
            line-height: 1.6;
            color: var(--text);
            background: var(--bg-0);
            border: none;
            outline: none;
            resize: none;
        }

        .editor::placeholder {
            color: var(--text-muted);
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: var(--bg-1);
            border-top: 1px solid var(--border);
        }

        .toolbar-left, .toolbar-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 14px;
            font-family: var(--sans);
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
            background: var(--bg-3);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn:hover:not(:disabled) {
            background: var(--bg-4);
            border-color: var(--text-muted);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            color: white;
            background: var(--accent);
            border-color: var(--accent);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--accent-hover);
            border-color: var(--accent-hover);
        }

        .btn-ghost {
            background: transparent;
            border-color: transparent;
        }

        .btn-ghost:hover:not(:disabled) {
            background: var(--bg-hover);
            border-color: transparent;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }

        .btn-icon {
            padding: 6px;
            min-width: 32px;
        }

        /* Output panel */
        .output-panel {
            height: 200px;
            background: var(--bg-1);
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .output-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .output-tabs {
            display: flex;
            gap: 4px;
        }

        .output-content {
            flex: 1;
            padding: 12px 16px;
            overflow-y: auto;
            font-family: var(--mono);
            font-size: 12px;
            line-height: 1.7;
        }

        .output-line {
            display: flex;
            gap: 12px;
            padding: 2px 0;
        }

        .output-time {
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .output-type {
            font-weight: 500;
            flex-shrink: 0;
            min-width: 40px;
        }

        .output-type.info { color: var(--text-secondary); }
        .output-type.ok { color: var(--success); }
        .output-type.err { color: var(--error); }
        .output-type.tx { color: var(--warning); }

        .output-msg {
            color: var(--text-secondary);
            word-break: break-all;
        }

        /* Result display */
        .result-panel {
            background: var(--bg-2);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius);
            margin: 8px 16px;
            overflow: hidden;
        }

        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            background: var(--bg-3);
            border-bottom: 1px solid var(--border-subtle);
        }

        .result-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .result-body {
            padding: 14px;
        }

        .result-row {
            display: flex;
            gap: 12px;
            padding: 4px 0;
            font-size: 13px;
        }

        .result-label {
            color: var(--text-muted);
            min-width: 80px;
        }

        .result-value {
            font-family: var(--mono);
            color: var(--text);
        }

        .result-value.hex { color: var(--accent); }
        .result-value.lambda { color: var(--purple); }
        .result-value.success { color: var(--success); }

        /* Badge */
        .badge {
            display: inline-flex;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: 500;
            border-radius: 9999px;
            background: var(--bg-3);
            color: var(--text-secondary);
        }

        .badge.success { background: rgba(34, 197, 94, 0.15); color: var(--success); }
        .badge.warning { background: rgba(234, 179, 8, 0.15); color: var(--warning); }
        .badge.error { background: rgba(239, 68, 68, 0.15); color: var(--error); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--bg-4); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--border); }

        /* Kbd styling */
        kbd {
            display: inline-flex;
            padding: 2px 6px;
            font-family: var(--mono);
            font-size: 11px;
            color: var(--text-muted);
            background: var(--bg-2);
            border: 1px solid var(--border);
            border-radius: 4px;
        }

        /* Empty state */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 40px;
            color: var(--text-muted);
            text-align: center;
        }

        .empty-icon {
            font-size: 32px;
            opacity: 0.5;
        }

        /* Examples dropdown */
        .examples-dropdown {
            position: relative;
            display: inline-block;
        }

        .examples-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 100;
            min-width: 200px;
            max-height: 400px;
            overflow-y: auto;
            background: var(--bg-2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            margin-top: 4px;
        }

        .examples-menu.open {
            display: block;
        }

        .examples-section {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-subtle);
        }

        .examples-section:last-child {
            border-bottom: none;
        }

        .examples-title {
            padding: 4px 12px;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .examples-menu button {
            display: block;
            width: 100%;
            padding: 6px 12px;
            text-align: left;
            font-family: var(--mono);
            font-size: 12px;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.1s;
        }

        .examples-menu button:hover {
            color: var(--text);
            background: var(--bg-hover);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .header-center { display: none; }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <div class="logo-icon">λ</div>
                    <span>BLC Debugger</span>
                </div>
            </div>

            <div class="header-center">
                <button class="tab active" data-tab="blc">Lambda Calculus</button>
                <button class="tab" data-tab="bf" title="BF interpreted via BLC (justine.lol/lambda)">Brainfuck</button>
                <button class="tab" data-tab="hex">Hex Editor</button>
            </div>

            <div class="header-right">
                <div id="conn-status" class="status-badge">
                    <div class="status-dot"></div>
                    <span>Offline</span>
                </div>
                <button class="btn btn-sm" onclick="connect()">Connect</button>
            </div>
        </header>

        <main class="main">
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Architecture -->
                <section class="sidebar-section">
                    <div class="sidebar-title">Architecture</div>
                    <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6;">
                        <div style="margin-bottom: 10px;">
                            <a href="https://justine.lol/lambda/" target="_blank" style="color: var(--accent); text-decoration: none;">BLC-VM</a> running on
                            <a href="https://github.com/polkavm/polkaports" target="_blank" style="color: var(--accent); text-decoration: none;">CoreVM</a>
                            (<a href="https://graypaper.fluffylabs.dev/" target="_blank" style="color: var(--accent); text-decoration: none;">JAM Service</a>) on
                            <a href="https://github.com/rotkonetworks/romio" target="_blank" style="color: var(--accent); text-decoration: none;">Romio Network</a>
                        </div>
                        <div style="font-size: 10px; color: var(--text-muted); font-family: var(--mono); margin-bottom: 10px;">
                            <a href="https://graypaper.fluffylabs.dev/" target="_blank" style="color: var(--text-muted); text-decoration: none;">JAM</a> →
                            <a href="https://pvm.fluffylabs.dev" target="_blank" style="color: var(--text-muted); text-decoration: none;">PVM</a> →
                            <a href="https://github.com/polkavm/polkaports" target="_blank" style="color: var(--text-muted); text-decoration: none;">CoreVM</a> →
                            <a href="https://justine.lol/lambda/" target="_blank" style="color: var(--text-muted); text-decoration: none;">BLC</a> →
                            λ
                        </div>
                        <div style="font-size: 10px;">
                            <a href="https://pvm.fluffylabs.dev" target="_blank" style="color: var(--text-muted); text-decoration: none; display: inline-flex; align-items: center; gap: 4px;">
                                <span>PVM Debugger ↗</span>
                            </a>
                        </div>
                    </div>
                </section>

                <!-- Network Stats -->
                <section class="sidebar-section">
                    <div class="sidebar-title">Network</div>
                    <div class="network-stats">
                        <div class="stat-card">
                            <div class="stat-label">Slot</div>
                            <div class="stat-value" id="jam-slot">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Epoch</div>
                            <div class="stat-value" id="jam-epoch">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Services</div>
                            <div class="stat-value accent" id="jam-services">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Block Time</div>
                            <div class="stat-value" id="jam-time">--</div>
                        </div>
                    </div>
                </section>

                <!-- Prelude -->
                <section class="sidebar-section">
                    <div class="sidebar-title">Combinators</div>
                    <div class="prelude-grid">
                        <button class="prelude-btn" onclick="loadPrelude('id')" title="Identity: λx.x">I</button>
                        <button class="prelude-btn" onclick="loadPrelude('k')" title="Kestrel: λxy.x">K</button>
                        <button class="prelude-btn" onclick="loadPrelude('s')" title="Starling: λxyz.xz(yz)">S</button>
                        <button class="prelude-btn" onclick="loadPrelude('y')" title="Y-Combinator">Y</button>
                        <button class="prelude-btn" onclick="loadPrelude('true')" title="Church True">T</button>
                        <button class="prelude-btn" onclick="loadPrelude('false')" title="Church False">F</button>
                        <button class="prelude-btn" onclick="loadPrelude('omega')" title="Omega: (λx.xx)(λx.xx)">Ω</button>
                        <button class="prelude-btn" onclick="loadPrelude('zero')" title="Church Numeral 0">0</button>
                    </div>
                </section>

                <!-- Connection Settings -->
                <section class="sidebar-section">
                    <div class="sidebar-title">Connection</div>
                    <div class="settings-group">
                        <div class="setting-row">
                            <span class="setting-label">RPC</span>
                            <select class="setting-input" id="rpc-preset" onchange="updateRpcUrl()">
                                <option value="local">Localhost</option>
                                <option value="romio">wss://romio.rotko.net</option>
                            </select>
                        </div>
                        <div class="setting-row" id="port-row">
                            <span class="setting-label">Port</span>
                            <input type="text" class="setting-input small" id="rpc-port" value="19800" onchange="updateRpcUrl()">
                            <span style="font-size: 11px; color: var(--text-muted); margin-left: 4px;" id="rpc-display">ws://localhost:19800</span>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Service</span>
                            <input type="text" class="setting-input small" id="service-id" value="1">
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Gas</span>
                            <input type="text" class="setting-input" id="gas-limit" value="10000000">
                        </div>
                    </div>
                </section>


                <!-- Execution Stats -->
                <section class="sidebar-section">
                    <div class="sidebar-title">Last Execution</div>
                    <div class="network-stats">
                        <div class="stat-card">
                            <div class="stat-label">Gas Used</div>
                            <div class="stat-value success" id="gas-used">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Steps</div>
                            <div class="stat-value" id="steps-used">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Result Size</div>
                            <div class="stat-value" id="result-size">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Status</div>
                            <div class="stat-value" id="exec-status">--</div>
                        </div>
                    </div>
                </section>
            </aside>

            <!-- Content -->
            <div class="content">
                <!-- Editor -->
                <div class="editor-container">
                    <div class="editor-header">
                        <div class="editor-tabs">
                            <button class="editor-tab active">input.blc</button>
                            <div class="examples-dropdown">
                                <button class="btn btn-ghost btn-sm" onclick="toggleExamples()">
                                    Examples ▾
                                </button>
                                <div class="examples-menu" id="examples-menu">
                                    <div class="examples-section">
                                        <div class="examples-title">Combinators</div>
                                        <button onclick="loadExample('id')">I (Identity)</button>
                                        <button onclick="loadExample('k')">K (Kestrel)</button>
                                        <button onclick="loadExample('s')">S (Starling)</button>
                                        <button onclick="loadExample('y')">Y (Fixed-point)</button>
                                        <button onclick="loadExample('omega')">Ω (Omega)</button>
                                    </div>
                                    <div class="examples-section">
                                        <div class="examples-title">Booleans</div>
                                        <button onclick="loadExample('true')">true (λλ1)</button>
                                        <button onclick="loadExample('false')">false (λλ0)</button>
                                        <button onclick="loadExample('if')">if</button>
                                        <button onclick="loadExample('or')">or</button>
                                        <button onclick="loadExample('and')">and</button>
                                        <button onclick="loadExample('not')">not</button>
                                        <button onclick="loadExample('xor')">xor</button>
                                    </div>
                                    <div class="examples-section">
                                        <div class="examples-title">Church Numerals</div>
                                        <button onclick="loadExample('zero')">0</button>
                                        <button onclick="loadExample('one')">1</button>
                                        <button onclick="loadExample('two')">2</button>
                                        <button onclick="loadExample('three')">3</button>
                                        <button onclick="loadExample('four')">4</button>
                                        <button onclick="loadExample('five')">5</button>
                                        <button onclick="loadExample('six')">6</button>
                                        <button onclick="loadExample('seven')">7</button>
                                        <button onclick="loadExample('eight')">8</button>
                                        <button onclick="loadExample('nine')">9</button>
                                    </div>
                                    <div class="examples-section">
                                        <div class="examples-title">Arithmetic</div>
                                        <button onclick="loadExample('iszero')">iszero</button>
                                        <button onclick="loadExample('inc')">inc (succ)</button>
                                        <button onclick="loadExample('dec')">dec (pred)</button>
                                        <button onclick="loadExample('add')">add</button>
                                        <button onclick="loadExample('sub')">sub</button>
                                        <button onclick="loadExample('mul')">mul</button>
                                        <button onclick="loadExample('pow')">pow</button>
                                    </div>
                                    <div class="examples-section">
                                        <div class="examples-title">Pairs & Lists</div>
                                        <button onclick="loadExample('nil')">nil</button>
                                        <button onclick="loadExample('pair')">pair (cons)</button>
                                        <button onclick="loadExample('car')">car (first)</button>
                                        <button onclick="loadExample('cdr')">cdr (rest)</button>
                                    </div>
                                    <div class="examples-section">
                                        <div class="examples-title">Programs (Hex)</div>
                                        <button onclick="loadExample('primes')">primes.blc</button>
                                        <button onclick="loadExample('reverse')">reverse.blc</button>
                                        <button onclick="loadExample('invert')">invert.blc</button>
                                        <button onclick="loadExample('uni')">uni.blc (BLC interpreter)</button>
                                    </div>
                                    <div class="examples-section" id="bf-examples">
                                        <div class="examples-title">Brainfuck</div>
                                        <button onclick="loadExample('bf_hello')">Hello World</button>
                                        <button onclick="loadExample('bf_add')">Add Two Numbers</button>
                                        <button onclick="loadExample('bf_multiply')">Multiply</button>
                                        <button onclick="loadExample('bf_fibonacci')">Fibonacci</button>
                                        <button onclick="loadExample('bf_squares')">Square Numbers</button>
                                        <button onclick="loadExample('bf_alphabet')">Alphabet</button>
                                        <button onclick="loadExample('bf_cat')">Cat (echo input)</button>
                                        <button onclick="loadExample('bf_rot13')">ROT13 Cipher</button>
                                        <button onclick="loadExample('bf_triangle')">Triangle Pattern</button>
                                        <button onclick="loadExample('bf_countdown')">Countdown</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="editor-actions">
                            <button class="btn btn-ghost btn-sm" onclick="formatCode()">Format</button>
                            <button class="btn btn-ghost btn-sm" onclick="clearEditor()">Clear</button>
                        </div>
                    </div>
                    <div class="editor-wrap">
                        <textarea class="editor" id="editor" placeholder="Enter lambda calculus expression...

Examples:
  λx.x           -- Identity
  λx.λy.x        -- Church TRUE (K combinator)
  (λx.x λy.y)    -- Application

Or enter hex:
  0x20           -- Identity (λx.x)
  0x0c           -- TRUE
"></textarea>
                    </div>
                </div>

                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="toolbar-left">
                        <button class="btn" onclick="parseCode()">
                            <span>Parse</span>
                            <kbd>⌘P</kbd>
                        </button>
                        <button class="btn btn-primary" id="run-btn" onclick="runCode()" disabled>
                            <span>▶ Run</span>
                            <kbd>⌘⏎</kbd>
                        </button>
                    </div>
                    <div class="toolbar-right">
                        <span id="parse-status" class="badge">Ready</span>
                    </div>
                </div>

                <!-- Output Panel -->
                <div class="output-panel">
                    <div class="output-header">
                        <div class="output-tabs">
                            <button class="editor-tab active" data-panel="result">Result</button>
                            <button class="editor-tab" data-panel="log">Log</button>
                            <button class="editor-tab" data-panel="hex">Hex</button>
                        </div>
                        <button class="btn btn-ghost btn-sm" onclick="clearOutput()">Clear</button>
                    </div>

                    <!-- Result Panel -->
                    <div class="output-content" id="result-panel">
                        <div class="empty-state">
                            <div class="empty-icon">λ</div>
                            <div>Enter an expression and click Run to evaluate</div>
                        </div>
                    </div>

                    <!-- Log Panel (hidden by default) -->
                    <div class="output-content" id="log-panel" style="display:none"></div>

                    <!-- Hex Panel (hidden by default) -->
                    <div class="output-content" id="hex-panel" style="display:none">
                        <div class="empty-state">
                            <div>Parse an expression to see hex encoding</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import init, * as blc from './pkg/blc_client.js';

        let ws = null;
        let wasmReady = false;
        let requestId = 1;
        let pendingRequests = {};
        let lastParsed = null;

        // JAM state
        let jamState = {
            slot: 0,
            epoch: 0,
            services: 0,
            pollInterval: null,
            jam_epoch_zero: 1735732800,
            slot_duration: 6,
            slots_per_epoch: 600
        };

        // Initialize
        async function init_app() {
            try {
                await init();
                wasmReady = true;
                log('info', 'WASM runtime initialized');
            } catch (e) {
                log('err', 'Failed to load WASM: ' + e);
            }

            // Setup keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                    e.preventDefault();
                    runCode();
                }
                if ((e.metaKey || e.ctrlKey) && e.key === 'p') {
                    e.preventDefault();
                    parseCode();
                }
            });

            // Setup tab switching
            document.querySelectorAll('.tab[data-tab]').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            document.querySelectorAll('.output-tabs .editor-tab').forEach(tab => {
                tab.addEventListener('click', () => switchOutputPanel(tab.dataset.panel));
            });

            // Auto-detect and connect to best RPC endpoint
            setTimeout(autoDetectRpc, 500);
        }

        // Logging
        function log(type, msg) {
            const panel = document.getElementById('log-panel');
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });
            const line = document.createElement('div');
            line.className = 'output-line';
            line.innerHTML = `
                <span class="output-time">${time}</span>
                <span class="output-type ${type}">${type.toUpperCase()}</span>
                <span class="output-msg">${escapeHtml(msg)}</span>
            `;
            panel.insertBefore(line, panel.firstChild);
        }

        function escapeHtml(t) {
            return t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        // RPC URL management
        const RPC_ENDPOINTS = {
            romio: 'wss://romio.rotko.net',
            local: 'ws://localhost'
        };

        function getRpcUrl() {
            const preset = document.getElementById('rpc-preset').value;
            if (preset === 'romio') {
                return RPC_ENDPOINTS.romio;
            } else {
                const port = document.getElementById('rpc-port').value || '19800';
                return `${RPC_ENDPOINTS.local}:${port}`;
            }
        }

        window.updateRpcUrl = function() {
            const preset = document.getElementById('rpc-preset').value;
            const portRow = document.getElementById('port-row');
            const display = document.getElementById('rpc-display');

            if (preset === 'romio') {
                portRow.style.display = 'none';
                display.textContent = RPC_ENDPOINTS.romio;
            } else {
                portRow.style.display = 'flex';
                const port = document.getElementById('rpc-port').value || '19800';
                display.textContent = `ws://localhost:${port}`;
            }
        };

        // Auto-detect best RPC endpoint (prefer localhost for dev)
        async function autoDetectRpc() {
            log('info', 'Auto-detecting RPC endpoint...');
            setStatus('connecting', 'Detecting...');

            const tryEndpoint = (url, timeout = 2000) => {
                return new Promise((resolve) => {
                    const testWs = new WebSocket(url);
                    const timer = setTimeout(() => {
                        testWs.close();
                        resolve(null);
                    }, timeout);

                    testWs.onopen = () => {
                        clearTimeout(timer);
                        testWs.close();
                        resolve(url);
                    };

                    testWs.onerror = () => {
                        clearTimeout(timer);
                        resolve(null);
                    };
                });
            };

            // Try localhost first (dev tool should prefer local)
            const port = document.getElementById('rpc-port').value || '19800';
            const localUrl = `${RPC_ENDPOINTS.local}:${port}`;
            const localResult = await tryEndpoint(localUrl, 1500);
            if (localResult) {
                document.getElementById('rpc-preset').value = 'local';
                updateRpcUrl();
                log('ok', 'Found: ' + localUrl);
                connect();
                return;
            }

            // Fallback to romio.rotko.net
            const romioResult = await tryEndpoint(RPC_ENDPOINTS.romio, 2000);
            if (romioResult) {
                document.getElementById('rpc-preset').value = 'romio';
                updateRpcUrl();
                log('ok', 'Found: ' + RPC_ENDPOINTS.romio);
                connect();
                return;
            }

            log('info', 'No RPC found. Start testnet: ./scripts/run-testnet.sh');
            setStatus('offline', 'Offline');
        }

        // Connection
        window.connect = function() {
            const url = getRpcUrl();
            setStatus('connecting', 'Connecting...');
            log('info', 'Connecting to ' + url);

            try {
                if (ws) ws.close();
                ws = new WebSocket(url);

                ws.onopen = () => {
                    setStatus('online', 'Online');
                    log('ok', 'Connected to testnet');
                    document.getElementById('run-btn').disabled = false;
                    startPolling();
                };

                ws.onclose = () => {
                    setStatus('offline', 'Offline');
                    log('info', 'Disconnected');
                    document.getElementById('run-btn').disabled = true;
                    stopPolling();
                };

                ws.onerror = () => {
                    setStatus('error', 'Error');
                    log('err', 'Connection failed');
                };

                ws.onmessage = (e) => {
                    try {
                        handleMessage(JSON.parse(e.data));
                    } catch (err) {
                        log('err', 'Parse error: ' + err.message);
                    }
                };
            } catch (e) {
                setStatus('error', 'Error');
                log('err', 'Connect failed: ' + e);
            }
        };

        function setStatus(cls, text) {
            const badge = document.getElementById('conn-status');
            badge.className = 'status-badge ' + cls;
            badge.querySelector('span').textContent = text;
        }

        function handleMessage(msg) {
            if (msg.id && pendingRequests[msg.id]) {
                const { resolve, reject, method } = pendingRequests[msg.id];
                delete pendingRequests[msg.id];
                if (msg.error) {
                    log('err', method + ': ' + msg.error.message);
                    reject(new Error(msg.error.message));
                } else {
                    resolve(msg.result);
                }
            }
        }

        function rpcCall(method, params) {
            return new Promise((resolve, reject) => {
                if (!ws || ws.readyState !== WebSocket.OPEN) {
                    reject(new Error('Not connected'));
                    return;
                }
                const id = requestId++;
                pendingRequests[id] = { resolve, reject, method };
                ws.send(JSON.stringify({ jsonrpc: '2.0', id, method, params }));
                setTimeout(() => {
                    if (pendingRequests[id]) {
                        delete pendingRequests[id];
                        reject(new Error('Timeout'));
                    }
                }, 10000);
            });
        }

        // Polling
        let timeInterval = null;

        function startPolling() {
            if (jamState.pollInterval) return;
            fetchState();
            jamState.pollInterval = setInterval(fetchState, 6000);
            if (!timeInterval) {
                timeInterval = setInterval(updateTimeDisplay, 100);
            }
        }

        function stopPolling() {
            if (jamState.pollInterval) {
                clearInterval(jamState.pollInterval);
                jamState.pollInterval = null;
            }
            if (timeInterval) {
                clearInterval(timeInterval);
                timeInterval = null;
            }
        }

        async function fetchState() {
            if (!ws || ws.readyState !== WebSocket.OPEN) return;
            try {
                // use bestBlock for slot info
                const block = await rpcCall('bestBlock', []);
                if (block) {
                    jamState.slot = block.slot || 0;
                    jamState.epoch = Math.floor(jamState.slot / jamState.slots_per_epoch);
                }
                // use listServices for service count
                const services = await rpcCall('listServices', []);
                if (services) {
                    jamState.services = services.length || 0;
                }
                updateDisplay();
            } catch (e) {
                // Silent fail
            }
        }

        function updateDisplay() {
            document.getElementById('jam-slot').textContent = jamState.slot.toLocaleString();
            document.getElementById('jam-epoch').textContent = jamState.epoch.toLocaleString();
            document.getElementById('jam-services').textContent = jamState.services;
        }

        function updateTimeDisplay() {
            const now = Date.now();
            const era = jamState.jam_epoch_zero * 1000;
            const slotMs = jamState.slot_duration * 1000;
            const progress = ((now - era) % slotMs) / slotMs;
            const sec = (progress * jamState.slot_duration).toFixed(1);
            document.getElementById('jam-time').textContent = sec + 's';
        }

        // Parsing
        window.parseCode = function() {
            if (!wasmReady) {
                log('err', 'WASM not ready');
                return;
            }

            let text = document.getElementById('editor').value.trim();
            if (!text) return;

            // Strip comment lines (-- for BLC, [ ] for BF)
            text = text.split('\n')
                .filter(line => !line.trim().startsWith('--'))
                .join('\n')
                .trim();
            if (!text) return;

            try {
                let parsed, hex;
                if (text.startsWith('0x') || /^[0-9a-fA-F]+$/.test(text)) {
                    parsed = blc.parse_blc_hex(text);
                    hex = text.replace('0x', '');
                } else {
                    parsed = blc.parse_blc_lambda(text);
                    hex = blc.encode_to_hex(text);
                }

                lastParsed = { term: parsed, hex: hex };

                document.getElementById('parse-status').textContent = 'Parsed';
                document.getElementById('parse-status').className = 'badge success';

                // Update hex panel - show lambda term prominently
                document.getElementById('hex-panel').innerHTML = `
                    <div class="result-row" style="margin-bottom: 8px;">
                        <span class="result-label">Term:</span>
                        <span class="result-value" style="color: var(--cyan); font-size: 14px;"><code>${escapeHtml(parsed)}</code></span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Hex:</span>
                        <span class="result-value hex">0x${hex}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Size:</span>
                        <span class="result-value">${hex.length / 2} bytes</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Bits:</span>
                        <span class="result-value">${formatBits(hex)}</span>
                    </div>
                `;

                log('ok', 'Parsed: ' + parsed + ' (0x' + hex + ')');
            } catch (e) {
                lastParsed = null;
                document.getElementById('parse-status').textContent = 'Error';
                document.getElementById('parse-status').className = 'badge error';
                log('err', 'Parse error: ' + e);
            }
        };

        function formatBits(hex) {
            return hex.match(/.{2}/g)
                .map(b => parseInt(b, 16).toString(2).padStart(8, '0'))
                .join(' ');
        }

        // Running
        window.runCode = async function() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('err', 'Not connected');
                return;
            }

            const text = document.getElementById('editor').value.trim();
            if (!text) return;

            // Handle different modes
            if (currentMode === 'bf') {
                await runBrainfuck(text);
                return;
            }

            // Parse first if not already parsed (BLC mode)
            if (!lastParsed) {
                parseCode();
                if (!lastParsed) return;
            }

            try {
                log('tx', 'Evaluating: 0x' + lastParsed.hex);
                document.getElementById('parse-status').textContent = 'Running...';
                document.getElementById('parse-status').className = 'badge warning';

                const serviceId = parseInt(document.getElementById('service-id').value) || 1;
                const gasLimit = parseInt(document.getElementById('gas-limit').value) || 10000000;

                // Use romio_refine to go through full JAM service stack
                const result = await rpcCall('romio_refine', [serviceId, '0x' + lastParsed.hex, gasLimit]);

                document.getElementById('parse-status').textContent = result.success ? 'Success' : 'Failed';
                document.getElementById('parse-status').className = 'badge ' + (result.success ? 'success' : 'error');

                // Update stats - use RPC field names: output_hex, payload_size, gas_used, steps
                document.getElementById('gas-used').textContent = (result.gas_used || 0).toLocaleString();
                document.getElementById('steps-used').textContent = (result.steps || 0).toLocaleString();
                document.getElementById('result-size').textContent = (result.payload_size || 0) + ' B';
                document.getElementById('exec-status').textContent = result.success ? '✓' : '✗';
                document.getElementById('exec-status').style.color = result.success ? 'var(--success)' : 'var(--error)';

                // Display result - RPC returns output/output_hex not result/result_hex
                // Parse hex to human-readable lambda notation
                let inputLambda = '--';
                let outputLambda = '--';
                try {
                    if (lastParsed.hex) {
                        inputLambda = wasm.parse_blc_hex(lastParsed.hex);
                    }
                } catch (e) { }
                try {
                    if (result.output_hex) {
                        outputLambda = wasm.parse_blc_hex(result.output_hex);
                    }
                } catch (e) { }

                document.getElementById('result-panel').innerHTML = `
                    <div class="result-panel">
                        <div class="result-header">
                            <span class="result-title">Evaluation Result</span>
                            <span class="badge ${result.success ? 'success' : 'error'}">${result.success ? 'Success' : 'Failed'}</span>
                        </div>
                        <div class="result-body">
                            <div class="result-row">
                                <span class="result-label">Input</span>
                                <span class="result-value"><code style="color:var(--cyan)">${escapeHtml(inputLambda)}</code> <span class="hex" style="opacity:0.6">0x${lastParsed.hex}</span></span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Output</span>
                                <span class="result-value"><code style="color:var(--green)">${escapeHtml(outputLambda)}</code> <span class="hex" style="opacity:0.6">0x${result.output_hex || '--'}</span></span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Gas</span>
                                <span class="result-value">${(result.gas_used || 0).toLocaleString()} / ${(result.gas_limit || 0).toLocaleString()}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Steps</span>
                                <span class="result-value">${(result.steps || 0).toLocaleString()}</span>
                            </div>
                            ${result.error ? `<div class="result-row">
                                <span class="result-label">Error</span>
                                <span class="result-value" style="color:var(--error)">${escapeHtml(result.error)}</span>
                            </div>` : ''}
                        </div>
                    </div>
                `;

                log('ok', `Result: ${outputLambda} (0x${result.output_hex || 'empty'})`);
            } catch (e) {
                document.getElementById('parse-status').textContent = 'Error';
                document.getElementById('parse-status').className = 'badge error';
                log('err', 'Execution failed: ' + e.message);
            }
        };

        // Run Brainfuck program
        async function runBrainfuck(code) {
            try {
                log('tx', 'Running Brainfuck: ' + code.slice(0, 50) + (code.length > 50 ? '...' : ''));
                document.getElementById('parse-status').textContent = 'Running...';
                document.getElementById('parse-status').className = 'badge warning';

                const serviceId = parseInt(document.getElementById('service-id').value) || 1;
                const maxSteps = parseInt(document.getElementById('gas-limit').value) || 10000;

                // BLC-based BF interpreter from justine.lol/lambda
                // The interpreter IS a BLC program - service just runs BLC
                const BLC_BF_INTERPRETER = '11723422222397997997999f3fc02f597979f000c2bfaf73e7f89cf80016f957' +
                    'f7deecccbce7c00c2fd0b7de73e005de16f67332f3302dfc2ff23402b23402e6' +
                    '7b87fcbfdfd6a7300b1673c42e9e20185bdc02de0161fe7d66854681651998160' +
                    'd81ce82766000a01ca8d00b8057f7ec0bf859dfb95ffefa25b00bd683';

                // Convert BF code to hex and prepend the BLC interpreter
                const encoder = new TextEncoder();
                const bytes = encoder.encode(code);
                const bfHex = Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
                // Combined: BLC_BF_INTERPRETER + BF_CODE = pure BLC program
                const hexPayload = '0x' + BLC_BF_INTERPRETER + bfHex;

                // Use romio_refine to run brainfuck through service
                let result;
                result = await rpcCall('romio_refine', [serviceId, hexPayload, maxSteps]);

                document.getElementById('parse-status').textContent = result.success ? 'Success' : 'Failed';
                document.getElementById('parse-status').className = 'badge ' + (result.success ? 'success' : 'error');

                // Update stats - use RPC field names
                document.getElementById('result-size').textContent = (result.payload_size || 0) + ' B';
                document.getElementById('exec-status').textContent = result.success ? '✓' : '✗';
                document.getElementById('exec-status').style.color = result.success ? 'var(--success)' : 'var(--error)';

                // Decode output as ASCII if possible
                let outputText = result.output || '';
                if (result.output_hex) {
                    try {
                        const hexStr = result.output_hex.replace('0x', '');
                        const bytes = hexStr.match(/.{2}/g) || [];
                        outputText = bytes.map(b => {
                            const code = parseInt(b, 16);
                            return code >= 32 && code < 127 ? String.fromCharCode(code) : '.';
                        }).join('');
                    } catch (e) {}
                }

                document.getElementById('result-panel').innerHTML = `
                    <div class="result-panel">
                        <div class="result-header">
                            <span class="result-title">Brainfuck Output</span>
                            <span class="badge ${result.success ? 'success' : 'error'}">${result.success ? 'Success' : 'Failed'}</span>
                        </div>
                        <div class="result-body">
                            <div class="result-row">
                                <span class="result-label">Output</span>
                                <span class="result-value" style="color: var(--cyan);">${escapeHtml(outputText) || '(empty)'}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Hex</span>
                                <span class="result-value hex">0x${result.output_hex || '--'}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Size</span>
                                <span class="result-value">${result.payload_size || 0} bytes</span>
                            </div>
                            ${result.error ? `<div class="result-row">
                                <span class="result-label">Error</span>
                                <span class="result-value" style="color:var(--error)">${escapeHtml(result.error)}</span>
                            </div>` : ''}
                        </div>
                    </div>
                `;

                log('ok', 'BF Output: ' + (outputText || '(empty)'));
            } catch (e) {
                document.getElementById('parse-status').textContent = 'Error';
                document.getElementById('parse-status').className = 'badge error';

                document.getElementById('result-panel').innerHTML = `
                    <div class="result-panel">
                        <div class="result-header">
                            <span class="result-title">Brainfuck Error</span>
                            <span class="badge error">Failed</span>
                        </div>
                        <div class="result-body">
                            <div class="result-row">
                                <span class="result-label">Error</span>
                                <span class="result-value" style="color:var(--error)">${escapeHtml(e.message)}</span>
                            </div>
                            <div style="margin-top: 12px; font-size: 11px; color: var(--text-muted);">
                                Note: Brainfuck requires a BF interpreter service deployed on the testnet.
                                Make sure the service ID matches a deployed BF-capable service.
                            </div>
                        </div>
                    </div>
                `;

                log('err', 'BF execution failed: ' + e.message);
            }
        }

        // Prelude (sidebar combinators)
        window.loadPrelude = function(name) {
            loadExample(name);
        };

        // Examples - use de Bruijn notation (λ.0 not λx.x)
        // De Bruijn indices: 0 = innermost bound var, 1 = next outer, etc.
        const EXAMPLES = {
            // Combinators - use hex for reliability
            id: { hex: '0x20', desc: 'Identity λ.0' },
            k: { hex: '0x0c', desc: 'Kestrel λλ1 (TRUE)' },
            s: { hex: '0x0014c28', desc: 'Starling λλλ((2 0)(1 0))' },
            y: { hex: '0x05bd4d74d5d40', desc: 'Y combinator (fixed-point)' },
            omega: { hex: '0x488880', desc: 'Omega (λ.0 0)(λ.0 0) - loops forever' },

            // Booleans
            true: { hex: '0x0c', desc: 'Church TRUE λλ1' },
            false: { hex: '0x08', desc: 'Church FALSE λλ0' },
            if: { hex: '0x0016', desc: 'If-then-else λλλ((2 1) 0)' },
            or: { hex: '0x0015c0', desc: 'OR λλ((1 1) 0)' },
            and: { hex: '0x001580', desc: 'AND λλ((1 0) 1)' },
            not: { hex: '0x050808c0', desc: 'NOT λ((0 λλ0) λλ1)' },
            xor: { hex: '0x001510080c00', desc: 'XOR' },

            // Church numerals
            zero: { hex: '0x08', desc: 'Church 0 = λλ0' },
            one: { hex: '0x2c', desc: 'Church 1 = λλ(1 0)' },
            two: { hex: '0x2d40', desc: 'Church 2 = λλ(1 (1 0))' },
            three: { hex: '0x2d50', desc: 'Church 3' },
            four: { hex: '0x2d54', desc: 'Church 4' },
            five: { hex: '0x2d5500', desc: 'Church 5' },
            six: { hex: '0x2d5540', desc: 'Church 6' },
            seven: { hex: '0x2d5550', desc: 'Church 7' },
            eight: { hex: '0x2d5554', desc: 'Church 8' },
            nine: { hex: '0x2d555500', desc: 'Church 9' },

            // Arithmetic
            iszero: { hex: '0x050808c0c0', desc: 'Test if n = 0' },
            inc: { hex: '0x001616c0', desc: 'Successor: n + 1' },
            dec: { hex: '0x0001578000c015c0', desc: 'Predecessor: n - 1' },
            add: { hex: '0x000015c058', desc: 'Addition: m + n' },
            sub: { hex: '0x001405001578000c015c0', desc: 'Subtraction: m - n' },
            mul: { hex: '0x00015700', desc: 'Multiplication: m × n' },
            pow: { hex: '0x001400', desc: 'Exponentiation: b^e' },

            // Pairs & Lists
            nil: { hex: '0x0c', desc: 'Empty list (TRUE)' },
            pair: { hex: '0x000540', desc: 'Pair λλλ((0 2) 1)' },
            car: { hex: '0x05180c00', desc: 'First of pair' },
            cdr: { hex: '0x05180800', desc: 'Second of pair' },

            // Programs (as hex - from justine.lol binary encodings)
            primes: { hex: '0x1914180c2e0441034011010c030341bc0c', desc: 'Outputs prime numbers' },
            reverse: { hex: '0x0014341401418', desc: 'Reverses a list' },
            invert: { hex: '0x160810140c050541c0', desc: 'Inverts bits in stream' },
            uni: { hex: '0x1806341418100544050bc0bc08', desc: 'Universal BLC interpreter' },

            // Brainfuck examples
            bf_hello: {
                bf: '++++++++[>++++[>++>+++>+++>+<<<<-]>+>+>->>+[<]<-]>>.>---.+++++++..+++.>>.<-.<.+++.------.--------.>>+.>++.',
                desc: 'Prints "Hello World!"'
            },
            bf_add: {
                bf: ',>,[<+>-]<.',
                desc: 'Adds two single-digit numbers (input as ASCII)'
            },
            bf_multiply: {
                bf: ',>,>++++++++[<------<------>>-]<<[>[>+>+<<-]>>[<<+>>-]<<<-]>>>++++++[<++++++++>-]<.',
                desc: 'Multiplies two single-digit numbers'
            },
            bf_fibonacci: {
                bf: '+++++++++++>+>>>>++++++++++++++++++++++++++++++++++++++++++++>++++++++++++++++++++++++++++++++<<<<<<[>[>>>>>>+>+<<<<<<<-]>>>>>>>[<<<<<<<+>>>>>>>-]<[>++++++++++[-<-[>>+>+<<<-]>>>[<<<+>>>-]+<[>[-]<[-]]>[<<[>>>+<<<-]>>[-]]<<]>>>[>>+>+<<<-]>>>[<<<+>>>-]+<[>[-]<[-]]>[<<+>>[-]]<<<<<<<]>>>>[-]<<<<<[>>[>>>>+<<<<-]<<-]<<-]',
                desc: 'Generates Fibonacci sequence'
            },
            bf_squares: {
                bf: '++++[>+++++<-]>[<+++++>-]+<+[>[>+>+<<-]++>>[<<+>>-]>>>[-]++>[-]+>>>+[[-]++++++>>>]<<<[[<++++++++<++>>-]+<.<[>----<-]<]<<[>>>>>[>>>[-]+++++++++<[>-<-]+++++++++>[-[<->-]+[<<<]]<[>+<-]>]<<-]<<-]',
                desc: 'Prints squares: 0, 1, 4, 9, 16...'
            },
            bf_alphabet: {
                bf: '+++++[>+++++[>++++<-]<-]>>+[.+]',
                desc: 'Prints A-Z alphabet'
            },
            bf_cat: {
                bf: ',[.,]',
                desc: 'Echo input (cat program)'
            },
            bf_rot13: {
                bf: ',[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>+<-[>++++++++++++++<-]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]>.[-]<,]',
                desc: 'ROT13 cipher encoder/decoder'
            },
            bf_triangle: {
                bf: '>++++[<++++++++>-]>++++++++[>++++<-]>>++>>>+>>>+<<<<<<<<<<[-[->+<]>[-<+>>>.<<]>>>[[->++++++++[>++++++<-]>.<<[->+<]+>[->++++++++++<<+>]>.[-]>]]+<<<[-[->+<]+>[-<+>>>-[->+<]++>[-<->]<<<]<<<<]++++++++++.+++.[-]<]++++++++++.',
                desc: 'Prints a triangle pattern'
            },
            bf_countdown: {
                bf: '++++++++++[>+++++++>++++++++++>+++>+<<<<-]>++.>+.+++++++..+++.>++.<<+++++++++++++++.>.+++.------.--------.>+.>.',
                desc: 'Prints countdown: 10 9 8 7...'
            }
        };

        window.toggleExamples = function() {
            const menu = document.getElementById('examples-menu');
            menu.classList.toggle('open');
        };

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.querySelector('.examples-dropdown');
            if (dropdown && !dropdown.contains(e.target)) {
                document.getElementById('examples-menu').classList.remove('open');
            }
        });

        window.loadExample = function(name) {
            const ex = EXAMPLES[name];
            if (!ex) return;

            const editor = document.getElementById('editor');

            if (ex.bf) {
                // Brainfuck example
                if (currentMode !== 'bf') switchTab('bf');
                editor.value = ex.bf;
            } else {
                // BLC example (always hex)
                if (currentMode === 'bf') switchTab('blc');
                editor.value = ex.hex;
            }

            lastParsed = null;
            document.getElementById('parse-status').textContent = 'Ready';
            document.getElementById('parse-status').className = 'badge';
            document.getElementById('examples-menu').classList.remove('open');
            log('info', `Loaded: ${name} - ${ex.desc}`);
        };

        // UI helpers
        window.formatCode = function() {
            // Simple formatting - just clean up whitespace
            const editor = document.getElementById('editor');
            editor.value = editor.value.trim().replace(/\s+/g, ' ');
        };

        window.clearEditor = function() {
            document.getElementById('editor').value = '';
            lastParsed = null;
            document.getElementById('parse-status').textContent = 'Ready';
            document.getElementById('parse-status').className = 'badge';
        };

        window.clearOutput = function() {
            document.getElementById('result-panel').innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">λ</div>
                    <div>Enter an expression and click Run to evaluate</div>
                </div>
            `;
            document.getElementById('log-panel').innerHTML = '';
            document.getElementById('hex-panel').innerHTML = `
                <div class="empty-state">
                    <div>Parse an expression to see hex encoding</div>
                </div>
            `;
        };

        // Current mode
        let currentMode = 'blc';

        function switchTab(tab) {
            document.querySelectorAll('.tab[data-tab]').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${tab}"]`).classList.add('active');
            currentMode = tab;

            const editor = document.getElementById('editor');
            const fileTab = document.querySelector('.editor-tab.active');

            if (tab === 'blc') {
                editor.placeholder = `Enter lambda calculus expression...

Examples:
  λx.x           -- Identity
  λx.λy.x        -- Church TRUE (K combinator)
  (λx.x λy.y)    -- Application

Or enter hex:
  0x20           -- Identity (λx.x)
  0x0c           -- TRUE
`;
                fileTab.textContent = 'input.blc';
            } else if (tab === 'bf') {
                editor.placeholder = `Enter Brainfuck program...

Commands:
  >  Move pointer right
  <  Move pointer left
  +  Increment cell
  -  Decrement cell
  .  Output cell as ASCII
  ,  Input character
  [  Jump forward if cell is 0
  ]  Jump back if cell is not 0

Example (Hello World):
  ++++++++[>++++[>++>+++>+++>+<<<<-]>+>+>->>+[<]<-]>>.>---.+++++++..+++.>>.<-.<.+++.------.--------.>>+.>++.
`;
                fileTab.textContent = 'input.bf';
            } else if (tab === 'hex') {
                editor.placeholder = `Enter raw hex bytes...

Format: 0x... or space-separated bytes
  0x00010203
  00 01 02 03
`;
                fileTab.textContent = 'input.hex';
            }

            lastParsed = null;
            document.getElementById('parse-status').textContent = 'Ready';
            document.getElementById('parse-status').className = 'badge';
        }

        function switchOutputPanel(panel) {
            document.querySelectorAll('.output-tabs .editor-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.output-tabs .editor-tab[data-panel="${panel}"]`).classList.add('active');

            document.getElementById('result-panel').style.display = panel === 'result' ? 'block' : 'none';
            document.getElementById('log-panel').style.display = panel === 'log' ? 'block' : 'none';
            document.getElementById('hex-panel').style.display = panel === 'hex' ? 'block' : 'none';
        }

        // Initialize
        init_app();
    </script>
</body>
</html>
